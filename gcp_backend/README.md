# APIs: Definition and Handling
**Importants Points**

- For calling to any API, in path `http://127.0.0.1:8000/` or `{{host}}` is provided. Later Replace it with the address of Server.
- All the data while calling the API are to be provided in Json format. Example will be provided.
- All organization needs to registered by super admin before user from that organization create accounts.
- There is authentication implemented at all points, so error codes defined below can occur in usage of any API and there ERROR CODES are unique, so always check for them <br>
- - **Status:** 203 <br> **Message:** `{"message": "Cookie not found"}`  <br> **Solution:** Direct user to Login Page.<br>
- - **Status:** 203 <br> **Message:** `'message' : 'Cookie expired'`  <br> **Solution:** Direct user to Login Page. <br>
- - **Status:** 401 <br> **Data:** `{"status":"error",
                "Message": "User is not club admin"}` <br> **Meaning:** User is not club admin.
- - **Status:** 204 <br> **Message:** `{"Message": "User with id does not exists"}`  <br> **Solution:** Direct user to SIGNIN page.<br>

---

## 1. SIGNUP API

Api used for signing in. </br>
**Only user with _Role_ as _Student_ can SIGNIN through this way.** </br>
`http://127.0.0.1:8000/user/signup` </br>
**Method:** POST <br>
**Data:** Json file in format <br/>

```json
{
  "name": "<name>",
  "email": "<Valid email>",
  "password": "<password length should be less than 14>",
  "role": "2",
  "organization": <organization id>
}
```

 </br>
Here Email needs to be valid. <br>
Password Length less than 14 <br>
Organization id needs to be provided. <br>
Example: <br>

```json
{
  "name": "J",
  "email": "A@a.com",
  "password": "a2162a545a",
  "role": "2",
  "organization": 1
}
```

**Return Types** <br>

- **Status:** 200 <br> **Data:** `{
  "status": "success",
  "user_id": 2
}` <br> **Meaning:** ID is created Successfully. User id is returned in Data.
- **Status:** 406 <br> **Data:** `{"status": "error", "data": "Invalid email or Phone number"}` <br> **Meaning:** Invalid email or Phone Number (if enter).
- **Status:** 406 <br> **Data:** `{"status":"error", "Message":"Either Role is not Student or Organisation is not Registered"}` <br> **Meaning:** Either Role is not Student or Organisation is not Registered.
- **Status:** 200 <br> **Data:** `{"status": "error", "data": serializer.errors}` <br> **Meaning:** Any other Error Generated by Backend.

---

## 2 LOGIN API

Used for Logging in. Can we used by _User_ with any _Role_. <br>
`{{host}}user/login` <br>
**METHOD:** POST <br>
**DATA:** <br>
`{
  "email": "<>",
  "password": "<>"
}` <br>
Example: <br>
`{
  "email": "A@a.com",
  "password": "a2162a545a"
}` <br>
**Return Types** <br>

- **Status:** 202 <br> **Data:** `{
  "user_id": <>,
  "role": "<>"
}` <br> **Meaning:** User exist within organisation.
- **Status:** 304 <br> **Data:** `{"Message": "Invalid Password"}` <br> **Meaning:** Wrong ID or password.
- **Status:** 400 <br> **Data:** `{"Message": server.error}` <br> **Meaning:** Internal error.

---

## 3 PROFILE UPDATE API

Used to update details of a account. Can be used with _User_ with any _Role_. Pass user id in URL <br>
`http://127.0.0.1:8000/user/profile` <br>
**METHOD:** PUT <br>
**DATA:** You need to just provide details which are changed from [email, name, password, Phone number,organization ] <br> **Pass only the fields which have changes.**<br>

```json
{
  "name": "<>",
  "ph_num": "<>",
  "password" : "<>",
  "email": "<>",
  "organization": <int>
}
```

Here Email needs to be valid. <br>
Password Length less than 14 <br>
Organization id needs to be provided. <br>
Example: <br>

```json
{
  "name": "W",
  "ph_num": "9999999999",
  "organization": 1
}
```

**Return Types** <br>

- **Status:** 401 <br> **Data:** `{"Message": "User with id does not exists"}` <br> **Meaning:** User with id does not exists.
- **Status:** 409 <br> **Data:** `{"status":"error", "Message":You cannot edit id, created by, updated by, is active and role through api call}` <br> **Meaning:** You cannot edit id, created by, updated by, is active and role through api call. <br>
- **Status:** 406 <br> **Data:** `{"status":"error", "Message":Email is not valid}` <br> **Meaning:** Email is not valid.
- **Status:** 405 <br> **Data:** `{"status":"error", "Message":Phone number is not valid}` <br> **Meaning:** Phone number is not valid.
- **Status:** 200 <br> **Data:** <br> **Meaning:** Changes saved.
- **Status:** 400 <br> **Data:** `{"status":"success", "Message":serializer.errors}` <br> **Meaning:** Error from server.

---
## 4 LOGOUT API
Used to logout any user account with any user type.
- **URL_ENDPOINT** -> `{{host}}/user/logout`
- **METHOD** -> `delete`
- **DATA** -> None
- **RESPONSE**
  - Status 200 -> Loged out successfully.
---
## 5 GET ALL CLUB ADMINS
Used to get a list of all the club admins under an organization.
- **URL_ENDPOINT** -> `{{host}}/user/club-admin`
- **METHOD** -> `get`
- **DATA** -> None
- **RESPONSE** 
  - Status 200
  ```json
    [
      {
        "userid" : ca.userid,  
        "name" : ca.name,
        "email" : ca.email,
        "ph_num" : ca.ph_num,
        "is_locked" : ca.is_locked
      }
    ]
  ```
---
## 6 Create Club Admin
Used to create a club admin, only super user have access to this.
- **URL_ENDPOINT** -> `{{host}}/user/club-admin`
- **METHOD** -> `post`
- **DATA** ->   
  ```json
    {
      "name": "Rupak2", 
      "email": "rupakbiswas2305@gmail.com",
      "password": "123123",
      "role": "1",
      "organization": "1"
    }
  ```
- **RESPONSE** 
---
## 7 Lock Club Admin
Used to lock a club admin, only super user have access to this.
- **URL_ENDPOINT** -> `{{host}}/user/club-admin`
- **METHOD** -> `put`
- **DATA** ->   
  ```json
    {
      "userid": "1",
      "is_locked": "true"
    }
  ```
---
## 8 Forget Password
Used to send a reset password link to the user.
- **URL_ENDPOINT** -> `{{host}}/user/forgotpass`
- **METHOD** -> `post`
- **DATA** ->   
  ```json
    {
      "email": "someemail@gmail.com"
    }
    ```
- **RESPONSE**
  - Status 200 -> Email sent successfully.
  - Status 404 -> Email not found.

## 9 Reset Password
Used to reset the password of the user.
- **URL_ENDPOINT** -> `{{host}}/user/forgotpass`
- **METHOD** -> `put`
- **DATA** ->   
  ```json
    {
      "password" : "resetpassword"
    }
  ```
---
## 10 ORGANIZATION API

Use to get list of Registered _Organizations_ and their _ID_ number. <br>
`http://127.0.0.1:8000/user/org/` <br>
**METHOD:** GET <br>
**Return Types** <br>

- **Status:** 200 <br> **Data:** `[{"name":"<>",
  "id": <>
},{"name": "<>","id":<>}]` <br> **Meaning:** List of Organization registered.

---

## 11 ADD AN EVENT API

Use to create a new event. </br>
Only user with _Role_ as **club_admin** can create an event. </br>
`http://127.0.0.1:8000/events/create/` <br>
**METHOD:** POST <br>
**DATA:** <br>

```json
{
  "name":"<>",
  "description": "<>",
  "_type": <int>,
  "tags": [<int>, <int>, ...],
  "start_date": "YYYY-MM-DD",
  "end_date": "YYYY-MM-DD",
  "social_links": "<>",
  "rsvp_link": "<>"
}
```

Here,

- **\_type** needs to be provided with **\_type id**
- **tags** need to be provided in **List** format with **tags id**
- **start_date**, **end_date** needs to be in **Year-Month-Day** format.
- **organization** is to provided with **organization id**
- **created_by** is to be provided with **user id**
- Here social_links, rsvp_link are optional <br>
  Example: <br>

```json
{
  "name": "A",
  "description": "ZZX",
  "_type": 1,
  "tags": [1, 2],
  "start_date": "2022-12-01",
  "end_date": "2022-12-03",
  "social_links": "adf",
  "rsvp_link": "adfads",
}
```

**Return Types** <br>

- **Status:** 400 <br> **Data:** `{"status":"error",
                "Message": "Organisation with id does not exists"}` <br> **Meaning:** Organisation with id does not exists.
- **Status:** 201 <br> **Data:** `{"status":"success","Message":"Event Added Successfully"}` <br> **Meaning:** Event Added Successfully.
- **Status:** 400 <br> **Data:** `{"status":"error","Message": serializer.errors}` <br> **Meaning:** Any other Error Generated by Backend..

---

## 12 EDIT AN EVENT API

Use to edit an event. <br>
Only user with _Role_ as **club_admin** can edit an event. </br>
`http://127.0.0.1:8000/events/edit?<event id>` <br>
**METHOD:** PUT <br>
**DATA:** <br>

```json
{
  "name":"<>",
  "description": "<>",
  "_type": <int>,
  "tags": [<int>,<int>],
  "start_date": "YYYY-MM-DD",
  "end_date": "YYYY-MM-DD",
  "social_links": "<>",
  "rsvp_link": "<>"
}
```

Here,

- **Provide only parameter which is changed**
- **\_type** needs to be provided with **\_type id**
- **tags** need to be provided in **List** format with **tags id**
- **start_date**, **end_date** needs to be in **Year-Month-Day** format.
- **organization** is to provided with **organization id**
- **created_by** is to be provided with **user id**
- Here social_links, rsvp_link are optional <br>
- User **cannot edit** organization and created_by <br>

**Return Types** <br>

- **Status:** 404 <br> **Data:** `{"status":"error",
                "Message": "Organisation with id does not exists"}` <br> **Meaning:** Organisation with id does not exists.
- **Status:** 401 <br> **Data:** `{"status":"error",
                "Message": "User doesn't exist within organisation"}` <br> **Meaning:** User doesn't exist within organisation.
- **Status:** 406 <br> **Data:** `{"status":"error",
                "Message": "Event with id does not exists"}` <br> **Meaning:** Event with id does not existsn.
- **Status:** 403 <br> **Data:** `        return Response(
            {"status":"error",
                "Message": "Cannot edit Organisation name or created by"}` <br> **Meaning:** Passing Organization or created by in Json of Data.
- **Status:** 201 <br> **Data:** `{"status":"success", "Message":"Update Successful"}` <br> **Meaning:** Event edited successful;y.
- **Status:** 400 <br> **Data:** `{"status":"error", "Message":serializer.errors}` <br> **Meaning:** Error from server.

---

## 13 ADD A SUBSCRIPTION API

Use to add an subscription for a user. Any user with any role can add a subscription. </br>
`http://127.0.0.1:8000/events/subs` </br>
**METHOD:** POST <br>
**DATA:** <br>
`{
  "event": <int>
}` </br>
Here, <br>

- Pass **User id** in **user**
- Pass **event id** in **event** <br>
  Example: <br>
  `{
  "event": 7
}` <br>

**Return Types:** <br>

- **Status:** 400 <br> **Data:** `{"status":"error", "Message":serializer.errors}` <br> **Meaning:** Error from server.
- **Status:** 201 <br> **Data:** `{"status":"success", "Message":"Subscription Added Successfully"}` <br> **Meaning:** Subscription Added Successfully.
- **Status:** 404 <br> **Data:** `{"status":"error", "Message":Your Organisation doesn't have this event}` <br> **Meaning:** Your Organisation doesn't have this event.

---

## 14 VIEW SUBSCRIPTION API

Use to view all the subscription of a user. <br>
`http://127.0.0.1:8000/events/subs`
**METHOD:** GET <br>
**Return Types:** <br>

- **Status:** 401 <br> **Data:** `{"status":"error", "Message":"User id not Provided"}` <br> **Meaning:** User id not Provided.
- **Status:** 200 <br> **Meaning:** Success <br> **Data:** Will contain a "Number" to indicate number of Subscription and "List" which contain all subscription details. <br> Example: <br>
  ```json
  {
    "Number": 1,
    "List": [
      {
        "id": 7,
        "name": "A",
        "description": "ZZe",
        "start_date": "2022-12-01T00:00:00Z",
        "end_date": "2022-12-03T00:00:00Z",
        "social_links": "adf",
        "rsvp_link": "adfads",
        "image": "",
        "Type": "ML-AI"
      }
    ]
  }
  ```

---

## 15 FILTER TAG API

Use to get all the tags.
`http://127.0.0.1:8000/events/tags`
**METHOD:** GET <br>
**Return Types:** <br>

- **Status:** 200 <br> **Meaning:** Success <br> **Data:** Will return a list of dictionary with _name_ as _Tag name_ and _id_ as _tag id_ <br>
  Example: <br>
  ```json
  [
    {
      "tag": "hackathon",
      "id": 1
    },
    {
      "tag": "Quizing",
      "id": 2
    }
  ]
  ```

---

## 16 ALL EVENTS API

Use to view all events of a Organisation. <br>
`http://127.0.0.1:8000/events/` <br>
**METHOD:** GET <br>
**Return Types:** <br>

- **Status:** 200 <br> **Meaning:** Success <br> **Data:** Will return a list of dictionary <br>
  Example <br>
  ```json
  [
    {
      "id": 4,
      "name": "A",
      "description": "ABC",
      "start_date": "2022-12-01T00:00:00Z",
      "end_date": "2022-12-03T00:00:00Z",
      "social_links": "adf",
      "rsvp_link": "adfads",
      "image": "",
      "tags": ["hackathon", "Quizing"],
      "Type": "ML-AI"
    },
    {
      "id": 7,
      "name": "A",
      "description": "ZZe",
      "start_date": "2022-12-01T00:00:00Z",
      "end_date": "2022-12-03T00:00:00Z",
      "social_links": "adf",
      "rsvp_link": "adfads",
      "image": "",
      "tags": ["hackathon", "Quizing"],
      "Type": "ML-AI"
    }
  ]
  ```

---

## 17 EVENTS FILTER API

Use to filter events. **This is a Dynamic filter 😊 search** <br>
`http://127.0.0.1:8000/events?` <br>
Add following category according to your wish and in any order in existing URL and separate multiple categories with '&' symbol <br>

- 'str_date=YYYY-MM-DD' for filtering according to starting date.
- 'end_date=YYYY-MM-DD' for filtering according to end date
- 'tags=<tag id>' for filtering according to tag name
- '\_type='<type id>' for filtering according to type of event. <br>

Example: <br>
`http://127.0.0.1:8000/events?tag=1&str_date=2022-12-01` <br>
**Return Types:** <br>

- **Status:** 200 <br> **Meaning:** Success <br> **Data:** Will return a list of dictionary <br>
  Example <br>
  ```json
  [
    {
      "id": 4,
      "name": "A",
      "description": "ABC",
      "start_date": "2022-12-01T00:00:00Z",
      "end_date": "2022-12-03T00:00:00Z",
      "social_links": "adf",
      "rsvp_link": "adfads",
      "image": "",
      "tags": ["hackathon", "Quizing"],
      "Type": "ML-AI"
    },
    {
      "id": 7,
      "name": "A",
      "description": "ZZe",
      "start_date": "2022-12-01T00:00:00Z",
      "end_date": "2022-12-03T00:00:00Z",
      "social_links": "adf",
      "rsvp_link": "adfads",
      "image": "",
      "tags": ["hackathon", "Quizing"],
      "Type": "ML-AI"
    }
  ]
  ```

---

## 18 ADD TAG API

Use to add an Tag. <br>
`http://127.0.0.1:8000/events/tags` <br>
**METHOD:** POST <br>
**DATA:** <br>
`{
  "tag": "<Tag Name>"
}` <br>
**Return Types:** <br>

- **Status:** 403 <br> **Data:** `{"status":"error", "Message":User doesn't exist}` <br> **Meaning:** User doesn't exist.
- **Status:** 201 <br> **Data:** `{"status":"success","Message":"Tag Added Successfully."}` <br> **Meaning:** Success.
- **Status:** 400 <br> **Data:** `{"status":"error", "Message":serializer.errors}` <br> **Meaning:** Error from server.

---

## 19 ADD AN TYPE OF EVENT API

Use to add an type of Event. <br>
`http://127.0.0.1:8000/events/type` <br>
**METHOD:** POST <br>
**DATA:** <br>
`{
  "type": "<Type Name>"
}` <br>
**Return Types:** <br>

- **Status:** 403 <br> **Data:** `{"status":"error", "Message":User doesn't exist}` <br> **Meaning:** User doesn't exist.
- **Status:** 201 <br> **Data:** `{"status":"success","Message":"Type Added Successfully."}` <br> **Meaning:** Success.
- **Status:** 400 <br> **Data:** `{"status":"error", "Message":serializer.errors}` <br> **Meaning:** Error from server.

---

## 20 FILTER TYPE API

Use to get all the type of events. <br>
`http://127.0.0.1:8000/events/type` <br>
**METHOD:** GET <br>
**Return Types:** <br>

- **Status:** 200 <br> **Meaning:** Success <br> **Data:** Will return a list of dictionary with _name_ as _Tag name_ and _id_ as _tag id_ <br>
  Example: <br>
  ```json
  [
    {
      "Type": "ML-AI",
      "id": 1
    }
  ]
  ```

---

## 21 GET USER INFO

To get user's details. <br>
`http://127.0.0.1:8000/user/profile` <br>
**METHOD:** GET <br>
**Return Types:** <br>

- **Status:** 200 <br> **Meaning:** Success <br> **Data:** Will return a dictionary
  Example: <br>
  ```json
  {
    "user_id": 1,
    "role": "2",
    "name": "ABC",
    "email": "A@abc.com",
    "ph_num": "9999999999",
    "organization": "DSC",
    "is_active": "True"
  }
  ```

---

## 22 LOGOUT API

To log a user out. <br>
`http://127.0.0.1:8000/user/logout` <br>
**Return Types:** <br>

- **Status:** 200 <br> **Meaning:** Success <br> **Data:** `{'message': 'User logged out successfully'}` <br>
